<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Account | Swift MD</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* Ensuring the layout matches your homepage professional look */
        body { background-color: #f8fafc; min-height: 100vh; display: flex; flex-direction: column; margin: 0; }
        .signup-container { flex: 1; display: flex; align-items: center; justify-content: center; padding: 40px 20px; }
        .signup-card { background: white; padding: 40px; border-radius: 16px; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); width: 100%; max-width: 400px; border: 1px solid #e2e8f0; }
        .form-group { display: flex; flex-direction: column; gap: 15px; margin-top: 25px; }
        input { padding: 12px; border: 1px solid #cbd5e1; border-radius: 8px; font-size: 1rem; }
        input:focus { outline: none; border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); }
        .role-selection { margin: 5px 0; }
        .role-labels { display: flex; gap: 20px; margin-top: 8px; }
        #kmpdcContainer { display: none; flex-direction: column; gap: 5px; margin-top: 10px; }
    </style>
</head>
<body>

    <header style="padding: 20px 50px; background: white; border-bottom: 1px solid #e2e8f0;">
        <h1 style="margin: 0; font-size: 1.5rem; font-family: sans-serif;">Swift <span style="color: #3b82f6;">MD</span></h1>
    </header>

    <div class="signup-container">
        <div class="signup-card">
            <h2 style="margin-top: 0; color: #0f172a; text-align: center;">Create Account</h2>
            
            <form id="signupForm" class="form-group">
                <input type="text" id="name" placeholder="Full Name" required>
                <input type="email" id="email" placeholder="Email Address" required>
                <input type="password" id="password" placeholder="Password" required>
                
                <div class="role-selection">
                    <label style="font-weight: 600; font-size: 0.9rem; color: #475569;">I am a:</label>
                    <div class="role-labels">
                        <label><input type="radio" name="role" value="patient" checked onclick="toggleKMPDC(false)"> Patient</label>
                        <label><input type="radio" name="role" value="doctor" onclick="toggleKMPDC(true)"> Doctor</label>
                    </div>
                </div>

                <div id="kmpdcContainer">
                    <input type="text" id="kmpdc_number" placeholder="KMPDC Registration Number">
                    <small style="color: #64748b; font-size: 0.75rem;">Required for medical practitioners.</small>
                </div>

                <input type="text" id="phone" placeholder="WhatsApp (e.g., 254...)" required>
                
                <button type="submit" id="submitBtn" class="btn-primary" style="width: 100%; border: none; cursor: pointer; padding: 14px; margin-top: 10px; background-color: #2563eb; color: white; border-radius: 8px; font-weight: bold;">
                    Send Verification Code
                </button>
            </form>

            <p style="text-align: center; font-size: 0.85rem; margin-top: 20px; color: #64748b;">
                Already have an account? <a href="login.html" style="color: #2563eb; text-decoration: none; font-weight: 600;">Login</a>
            </p>
        </div>
    </div>

    <script>
        // Toggle KMPDC field visibility
        function toggleKMPDC(isDoctor) {
            const container = document.getElementById('kmpdcContainer');
            const input = document.getElementById('kmpdc_number');
            
            if (isDoctor) {
                container.style.display = 'flex';
                input.setAttribute('required', 'true');
            } else {
                container.style.display = 'none';
                input.removeAttribute('required');
                input.value = ''; 
            }
        }

        // Handle Form Submission
        document.getElementById('signupForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.innerText = 'Sending...';

            const role = document.querySelector('input[name="role"]:checked').value;
            const formData = {
                name: document.getElementById('name').value,
                email: document.getElementById('email').value,
                password: document.getElementById('password').value,
                phone: document.getElementById('phone').value,
                role: role,
                kmpdc_number: role === 'doctor' ? document.getElementById('kmpdc_number').value : null
            };

            try {
                // Changed endpoint to /api/auth/send-otp to trigger verification flow
                const response = await fetch('https://medicareai-4av2.onrender.com/api/auth/send-otp', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });

                const data = await response.json();

                if (response.ok) {
                    // Store formData temporarily so verify-otp.html can access phone/email
                    localStorage.setItem('pendingUser', JSON.stringify(formData));
                    window.location.href = '/verify-otp.html';
                } else {
                    alert('Verification failed: ' + (data.error || 'Please try again.'));
                    submitBtn.disabled = false;
                    submitBtn.innerText = 'Send Verification Code';
                }
            } catch (err) {
                console.error('Error:', err);
                alert('Connection error. Is the server running?');
                submitBtn.disabled = false;
                submitBtn.innerText = 'Send Verification Code';
            }
        });
    </script>
</body>
</html>